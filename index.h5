<!DOCTYPE HTML>
<html>
<script type="text/javascript">
function iClick(){
	//alert("Hello, World!");
	//if (confirm("Are you OK?"))
	//else
}

function refreshWin()
{
	if (road.width == 0) return;

	var i=0;
	var curp = pos;

	while(curp < c.height)
	{
		cxt.drawImage(road,(c.width-road.width)/2,curp);
		curp += road.height;
		i++;
	}

	cxt.drawImage(car,x,y);
}

function timeFresh()
{
	pos += a;
	if (pos>0)
		pos -= road.height;

	y -= ca;

	car.src = "car0.png";
	if (37 == keynum) //left
	{
		x -= Math.abs(ca);
		car.src = "car1.png";
	}
	else if (39 == keynum) //right
	{
		x += Math.abs(ca);
		car.src = "car2.png";
	}

	if(y<0)
	{
		y = 0;
		ca = 0
	}

	if(y>c.height-car.height)
	{
		y = c.height-car.height;
		ca = 0;
	}
	x = (x<c.width/2-105)? c.width/2-105:x;
	x = (x>c.width/2+15)? c.width/2+15:x;

	refreshWin();
}

function iKeydown(e)
{
	var xx=x, yy=y, ww=car.width, hh=car.height;
	keynum = window.event ? e.keyCode : e.which;
	keychar = String.fromCharCode(keynum);
	//alert(keynum+':'+keychar);

	if (keynum == 27) document.cancelFullScreen(); //esc

	if (keynum == lastkey)
	{
		if (38 == keynum) //up
		{
			ca += 0.1;
			a++;
		}
		if (40 == keynum) //down
		{
			ca -= 0.1;
			a--;
		}
	}

	a = (a > 10)? 10:a;
	a = (a < 1)? 1:a;
	ca = (ca > 5)? 5:ca;
	ca = (ca < -5)? -5:ca;
	lastkey = keynum;
//if (ca>0) yy = y+car.height; 
//	alert("width="+car.width+",height="+car.height);

	//cxt.fillStyle="#FFFFFF";
	//cxt.fillRect(xx,yy,ww,hh);
}

function iKeyup(e)
{
    if (lastkey != keynum)
        keynum = 0;
    //console.log("keyup");
}

function iLoad(){
	pos = -road.height;
	refreshWin();
	setInterval(timeFresh, 50);
}
</script>
<body onkeydown="return iKeydown(event)" onkeyup="return iKeyup(event)" onload="">

<canvas id="myCanvas" width="800" height="600" style="border:1px solid #c3c3c3;" onclick="iClick()">
Your browser does not support the canvas element.
</canvas>

<script type="text/javascript">
//document.getElementById("myCanvas").requestFullScreen();
var keynum=0;
c=document.getElementById("myCanvas");
var pos=0;
var car=new Image();
for (i=2;i>=0;i--)
	car.src="/car"+i+".png";

var road=new Image();
road.src="road.png";
road.onload = iLoad;
cxt=c.getContext("2d");
x=c.width/2;
y=c.height/2;
a=1, ca=0, lastkey=0;

//document.write("<script language='javascript' src='one.js'><script>");
//setTimeout(drawBk, 50);
//setInterval(timeFresh, 50);
</script>

</body>
</html>
